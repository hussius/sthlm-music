---
phase: 06-fix-calendar-ui-gaps
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - client/src/components/FilterBar.tsx
autonomous: true
requirements:
  - FILT-02
  - FILT-03

must_haves:
  truths:
    - "Genre filter select is visible in the FilterBar (not commented out)"
    - "Genre filter has 11 selectable options matching canonical DB values (lowercase)"
    - "Selecting a genre filters the event list to only that genre"
    - "Clearing filters resets genre to 'All Genres'"
  artifacts:
    - path: "client/src/components/FilterBar.tsx"
      provides: "Uncommented genre filter with 11 canonical genre options"
      contains: "rock\", \"pop\", \"electronic\", \"jazz\", \"hip-hop\", \"metal\", \"indie\", \"folk\", \"classical\", \"world\", \"other"
  key_links:
    - from: "client/src/components/FilterBar.tsx"
      to: "useFilterState hook"
      via: "updateFilters({ genre: e.target.value || undefined })"
      pattern: "updateFilters.*genre"
    - from: "genre filter select value"
      to: "src/repositories/events.repository.ts"
      via: "API query param genre= passed as-is to eq(events.genre, filters.genre)"
      pattern: "lowercase genre values only"
---

<objective>
Uncomment the genre filter in FilterBar and populate it with all 11 canonical genre options matching the database values.

Purpose: The genre filter select exists at FilterBar lines 93-109 but is entirely wrapped in a JSX comment block. The select has no options beyond "All Genres". Users cannot filter by genre at all. This is a one-file, two-part change: uncomment + populate.

Output: Genre filter is visible and functional. Selecting "Rock" sends `genre=rock` to the API and filters results.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-fix-calendar-ui-gaps/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Uncomment genre filter and add 11 canonical genre options</name>
  <files>client/src/components/FilterBar.tsx</files>
  <action>
Make one surgical change to FilterBar.tsx: uncomment the genre filter block and populate its options.

**Current state (lines 93-109):**
```tsx
      {/* Genre Filter - Hidden (not useful with current data)
      <div className="flex flex-col gap-2">
        <label htmlFor="genre" className="text-sm font-medium text-gray-700">
          Genre
        </label>
        <select
          id="genre"
          value={filters.genre || ''}
          onChange={(e) =>
            updateFilters({ genre: e.target.value || undefined })
          }
          className="px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">All Genres</option>
        </select>
      </div>
      */}
```

**Replace with (lines 93-124, directly before the Venue Filter comment):**
```tsx
      {/* Genre Filter */}
      <div className="flex flex-col gap-2">
        <label htmlFor="genre" className="text-sm font-medium text-gray-700">
          Genre
        </label>
        <select
          id="genre"
          value={filters.genre || ''}
          onChange={(e) =>
            updateFilters({ genre: e.target.value || undefined })
          }
          className="px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
          <option value="">All Genres</option>
          <option value="rock">Rock</option>
          <option value="pop">Pop</option>
          <option value="electronic">Electronic</option>
          <option value="jazz">Jazz</option>
          <option value="hip-hop">Hip-hop</option>
          <option value="metal">Metal</option>
          <option value="indie">Indie</option>
          <option value="folk">Folk</option>
          <option value="classical">Classical</option>
          <option value="world">World</option>
          <option value="other">Other</option>
        </select>
      </div>
```

CRITICAL: All option `value` attributes MUST be lowercase to match `CANONICAL_GENRES` in `src/normalization/genre-mappings.ts`. The API does an exact match: `eq(events.genre, filters.genre)`. A value of `"Rock"` would return zero results; `"rock"` returns results.

Do NOT change any other part of FilterBar.tsx. Do NOT modify the venue filter, date inputs, search inputs, clear button, or useEffect hooks.
  </action>
  <verify>
1. `cd /Users/hussmikael/agents-hackathon/client && npx tsc --noEmit` — no TypeScript errors.
2. `grep -c "option value=" client/src/components/FilterBar.tsx` — should return 13 (1 All Genres + 11 genres + 1 All Venues or more venue options, i.e. at least 13).
3. `grep "option value=\"rock\"" client/src/components/FilterBar.tsx` — returns a matching line.
4. `grep "{/\* Genre Filter - Hidden" client/src/components/FilterBar.tsx` — returns no output (comment block is gone).
  </verify>
  <done>Genre filter select is visible in FilterBar. It has 12 options (All Genres + 11 genres). All option values are lowercase. The comment wrapping the block is removed.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    - Genre filter uncommented and visible in FilterBar
    - 11 genre options with lowercase values matching canonical DB genres
    - Slaktkyrkan already confirmed present in venue dropdown (verified during planning)
  </what-built>
  <how-to-verify>
    1. Open the app in the browser (dev server running from Plan 06-01)
    2. Verify the FilterBar shows a "Genre" dropdown above the "Venue" dropdown
    3. Click the Genre dropdown — confirm it shows: All Genres, Rock, Pop, Electronic, Jazz, Hip-hop, Metal, Indie, Folk, Classical, World, Other
    4. Select "Metal" — the event list should update to show only metal events (Fredagsmangel hardcodes metal genre, so at least those events should appear)
    5. Select "All Genres" — all events should return
    6. Click "Clear All Filters" — genre select should reset to "All Genres"
    7. Verify the Venue dropdown still contains "Slaktkyrkan" as an option
  </how-to-verify>
  <resume-signal>Type "approved" if genre filter works correctly, or describe what is wrong</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- Genre filter select visible in UI above venue filter
- 11 genre options present with lowercase values
- Selecting "metal" returns only metal-tagged events (at minimum Fredagsmangel events)
- Selecting "All Genres" returns all events
- Clear All Filters resets genre selection
- Venue filter still includes Slaktkyrkan
</verification>

<success_criteria>
- FILT-02: Genre filter select visible and functional — selecting a genre filters to that genre only
- FILT-03: Venue filter already has all active crawlers represented (Slaktkyrkan confirmed present); genre filter does not affect venue filter
- All 5 phase success criteria now met across plans 06-01 and 06-02
</success_criteria>

<output>
After completion, create `.planning/phases/06-fix-calendar-ui-gaps/06-02-SUMMARY.md` using the summary template.
</output>
