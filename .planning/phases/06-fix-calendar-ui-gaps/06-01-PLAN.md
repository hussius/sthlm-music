---
phase: 06-fix-calendar-ui-gaps
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/components/EventList.tsx
  - client/src/components/EventCard.tsx
autonomous: true
requirements:
  - DISP-02
  - DISP-03

must_haves:
  truths:
    - "Clicking any event card opens the EventModal showing full event details"
    - "EventModal displays artist, genre, price, and all ticket sources"
    - "The infinite scroll trigger div has no yellow background or debug text"
    - "Keyboard users can open the modal via Enter or Space on any event card"
  artifacts:
    - path: "client/src/components/EventList.tsx"
      provides: "selectedEvent state, EventModal wiring, cleaned-up scroll trigger"
      contains: "useState, EventModal, setSelectedEvent"
    - path: "client/src/components/EventCard.tsx"
      provides: "Clickable card that fires onSelect callback instead of navigating"
      contains: "onSelect"
  key_links:
    - from: "client/src/components/EventList.tsx"
      to: "client/src/components/EventCard.tsx"
      via: "onSelect prop"
      pattern: "onSelect.*setSelectedEvent"
    - from: "client/src/components/EventList.tsx"
      to: "client/src/components/EventModal.tsx"
      via: "conditional render of selectedEvent"
      pattern: "selectedEvent && <EventModal"
---

<objective>
Wire the already-built EventModal into EventList via EventCard click handlers, and remove the debug pagination banner from EventList.

Purpose: EventModal.tsx is fully implemented but never rendered. Users currently have no way to see artist, genre, price, or multiple ticket sources. This plan closes DISP-02 (full event detail view) and DISP-03 (ticket source display) in one pass.

Output: Clicking any event card opens EventModal with full details. The yellow debug banner is gone.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-fix-calendar-ui-gaps/06-RESEARCH.md
@client/src/components/EventModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove debug banner and wire EventModal state in EventList</name>
  <files>client/src/components/EventList.tsx</files>
  <action>
Make three surgical changes to EventList.tsx:

**Change 1 — Add imports (line 13):**
Add `useState` to the existing React import and add EventModal import after line 18:
```tsx
import { useEffect, useState } from 'react';
// ...existing imports...
import { EventModal } from './EventModal';
```

**Change 2 — Add selectedEvent state (after line 22, inside EventList component body):**
```tsx
const [selectedEvent, setSelectedEvent] = useState<EventResponse | null>(null);
```

**Change 3 — Pass onSelect to EventCard (line 94, current):**
Change:
```tsx
<EventCard key={event.id} event={event} />
```
To:
```tsx
<EventCard key={event.id} event={event} onSelect={() => setSelectedEvent(event)} />
```

**Change 4 — Remove debug banner, keep ref (lines 99-106):**
Replace:
```tsx
<div ref={ref} className="py-5 text-center bg-yellow-100">
  <p className="text-xs text-gray-500">
    hasNextPage: {String(hasNextPage)} | isFetchingNextPage: {String(isFetchingNextPage)}
  </p>
  {isFetchingNextPage && (
    <p className="text-gray-600">Loading more events...</p>
  )}
</div>
```
With:
```tsx
<div ref={ref} className="py-5 text-center">
  {isFetchingNextPage && (
    <p className="text-gray-600">Loading more events...</p>
  )}
</div>
```
CRITICAL: Keep `ref={ref}` — it is the infinite scroll intersection observer trigger. Removing it breaks pagination.

**Change 5 — Replace modal comment (line 108):**
Replace:
```tsx
{/* Modal disabled for now */}
```
With:
```tsx
{selectedEvent && (
  <EventModal event={selectedEvent} onClose={() => setSelectedEvent(null)} />
)}
```

Do NOT change anything else in the file.
  </action>
  <verify>Run `cd /Users/hussmikael/agents-hackathon/client && npx tsc --noEmit` — must complete with no errors related to EventList.tsx or EventModal.tsx. Also verify: `grep -n "bg-yellow-100" client/src/components/EventList.tsx` returns no output.</verify>
  <done>EventList.tsx has no yellow banner, imports useState and EventModal, passes onSelect to each EventCard, and conditionally renders EventModal when selectedEvent is set.</done>
</task>

<task type="auto">
  <name>Task 2: Make EventCard a clickable article for modal trigger</name>
  <files>client/src/components/EventCard.tsx</files>
  <action>
Replace the dual-render pattern (lines 15-71) with a single unified clickable article.

**Change 1 — Update EventCardProps interface (lines 15-17):**
```tsx
interface EventCardProps {
  event: EventResponse;
  onSelect?: () => void;
}
```

**Change 2 — Update function signature (line 19):**
```tsx
export function EventCard({ event, onSelect }: EventCardProps) {
```

**Change 3 — Remove the ticketUrl variable (line 22):**
The `ticketUrl` variable is no longer needed for navigation (the modal now handles ticket links). Remove:
```tsx
const ticketUrl = event.ticketSources[0]?.url;
```

**Change 4 — Replace the entire conditional return block (lines 52-71):**
Delete the two separate `if (!ticketUrl)` and `<a>` renders. Replace with a single return:
```tsx
return (
  <article
    onClick={onSelect}
    className={`border border-gray-200 rounded-lg p-3 bg-white shadow-sm${onSelect ? ' cursor-pointer hover:shadow-md hover:border-blue-400 transition-all' : ''}`}
    role={onSelect ? 'button' : undefined}
    tabIndex={onSelect ? 0 : undefined}
    onKeyDown={onSelect ? (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onSelect(); } } : undefined}
  >
    {cardContent}
  </article>
);
```

The full file after changes should have no `<a>` tag, no `ticketUrl` variable, and no conditional returns based on ticket URL presence. The cardContent JSX block (lines 24-50) remains unchanged.

Do NOT change the cardContent block or any imports.
  </action>
  <verify>Run `cd /Users/hussmikael/agents-hackathon/client && npx tsc --noEmit` — must complete with no TypeScript errors. Also verify: `grep -n "href=" client/src/components/EventCard.tsx` returns no output (no `<a>` tags remain).</verify>
  <done>EventCard renders as a single clickable article in all cases. When onSelect is provided: cursor-pointer hover styles applied, keyboard Enter/Space fires onSelect. No direct ticket URL navigation from the card — that happens in the modal.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    - EventCard is now a clickable article (no direct ticket URL navigation)
    - EventList wires onSelect to setSelectedEvent
    - EventModal renders conditionally when an event is selected
    - Debug yellow banner removed, infinite scroll ref preserved
  </what-built>
  <how-to-verify>
    1. Start the dev server: `cd /Users/hussmikael/agents-hackathon && npm run dev` (or `cd client && npm run dev`)
    2. Open the app in the browser
    3. Click any event card — EventModal should open as an overlay
    4. Verify the modal shows: event name, artist (if present), genre, date/time, venue, price, and ticket source links
    5. Press Escape — modal should close
    6. Click the backdrop (outside the modal) — modal should close
    7. Scroll to the bottom of the event list — "Loading more events..." should appear without a yellow background
    8. Verify keyboard: Tab to an event card, press Enter — modal should open
  </how-to-verify>
  <resume-signal>Type "approved" if modal works correctly, or describe what is wrong</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors in EventList.tsx or EventCard.tsx
- No `bg-yellow-100` class remaining in EventList.tsx
- No `<a href=` tags in EventCard.tsx
- EventModal renders on card click and closes on Escape/backdrop
- Infinite scroll still loads more pages on scroll-to-bottom
</verification>

<success_criteria>
- DISP-02: EventModal opens on any card click showing artist, genre, price
- DISP-03: Modal displays all ticket sources with working links
- Debug banner gone — no yellow background on pagination trigger div
- Infinite scroll continues to work (ref intact)
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/06-fix-calendar-ui-gaps/06-01-SUMMARY.md` using the summary template.
</output>
